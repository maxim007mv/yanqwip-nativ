# Backend Yanqwip ‚Äì FastAPI

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
backend/
‚îú‚îÄ‚îÄ app/
‚îÇ   ‚îú‚îÄ‚îÄ main.py           # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞ FastAPI
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ auth.py       # /auth/* —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ routes.py     # /routes/* —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ places.py     # /places/* —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ agent.py      # /agent/* —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (streaming)
‚îÇ   ‚îú‚îÄ‚îÄ models/           # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ schemas/          # Pydantic —Å—Ö–µ–º—ã
‚îÇ   ‚îú‚îÄ‚îÄ services/         # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îÇ   ‚îú‚îÄ‚îÄ core/             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
‚îÇ   ‚îî‚îÄ‚îÄ db/               # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
‚îú‚îÄ‚îÄ requirements.txt
‚îî‚îÄ‚îÄ Dockerfile
```

## –¢—Ä–µ–±—É–µ–º—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã

### 1. Auth
- `POST /auth/login` ‚Äì –≤—Ö–æ–¥ (email, password)
- `POST /auth/register` ‚Äì —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è
- `POST /auth/refresh` ‚Äì –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- `GET /auth/me` ‚Äì —Ç–µ–∫—É—â–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å

### 2. Routes
- `POST /routes/generate` ‚Äì –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–∞ (20-40 —Å–µ–∫)
  - Input: `{answers: [], context: {city, budget, categories}}`
  - Output: `{route: {title, summary, tags, steps[], tips[], totalDuration}}`
- `GET /routes/my` ‚Äì –º–æ–∏ –º–∞—Ä—à—Ä—É—Ç—ã
- `GET /routes/public?limit=10` ‚Äì –ø—É–±–ª–∏—á–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
- `GET /routes/:id` ‚Äì –¥–µ—Ç–∞–ª–∏ –º–∞—Ä—à—Ä—É—Ç–∞
- `POST /routes` ‚Äì —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç
- `DELETE /routes/:id` ‚Äì —É–¥–∞–ª–∏—Ç—å –º–∞—Ä—à—Ä—É—Ç
- `POST /routes/:id/like` ‚Äì –ª–∞–π–∫–Ω—É—Ç—å –º–∞—Ä—à—Ä—É—Ç

### 3. Places
- `GET /places?category=cafe` ‚Äì –≤—Å–µ –º–µ—Å—Ç–∞
- `GET /places/search?q=...&category=...` ‚Äì –ø–æ–∏—Å–∫
- `GET /places/:id` ‚Äì –¥–µ—Ç–∞–ª–∏ –º–µ—Å—Ç–∞
- `POST /places/:id/favorite` ‚Äì –¥–æ–±–∞–≤–∏—Ç—å –≤ –∏–∑–±—Ä–∞–Ω–Ω–æ–µ

### 4. Agent (Streaming)
- `POST /agent/chat` ‚Äì —Å—Ç—Ä–∏–º–∏–Ω–≥–æ–≤—ã–π —á–∞—Ç
  - Input: `{message: string, history: [], context: {}}`
  - Output: **Server-Sent Events** –∏–ª–∏ **chunked response**
  - –ü—Ä–∏–º–µ—Ä FastAPI:

```python
from fastapi import FastAPI
from fastapi.responses import StreamingResponse

@app.post("/agent/chat")
async def agent_chat(request: ChatRequest):
    async def generate():
        # –í—ã–∑–æ–≤ LLM (OpenAI, Anthropic –∏ —Ç.–¥.)
        async for chunk in llm_stream(request.message, request.history):
            yield chunk.encode('utf-8')
    
    return StreamingResponse(generate(), media_type="text/plain")
```

## –°–∏—Å—Ç–µ–º–Ω—ã–µ –ø—Ä–æ–º—Ç—ã

### –ò–ò-–∞–≥–µ–Ω—Ç (–±—ã—Å—Ç—Ä—ã–π —á–∞—Ç)
```
–¢—ã ‚Äî –¥–æ–±—Ä–æ–∂–µ–ª–∞—Ç–µ–ª—å–Ω—ã–π –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–æ–º–æ—â–Ω–∏–∫-–≥–∏–¥. 
–û—Ç–≤–µ—á–∞–π –Ω–∞ –ª—é–±—ã–µ –≤–æ–ø—Ä–æ—Å—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–æ –ú–æ—Å–∫–≤–µ –∏ –æ–∫—Ä–µ—Å—Ç–Ω–æ—Å—Ç—è–º: 
–≥–¥–µ –ø–æ–µ—Å—Ç—å, –∫—É–¥–∞ —Å—Ö–æ–¥–∏—Ç—å, –∫–∞–∫–∏–µ –∫–∞—Ñ–µ —Ä—è–¥–æ–º, –∫–∞–∫ –¥–æ–µ—Ö–∞—Ç—å –∏ —Ç.–¥. 
–û—Ç–≤–µ—á–∞–π –∫—Ä–∞—Ç–∫–æ, —á—ë—Ç–∫–æ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ. 
–ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –Ω–µ—è—Å–µ–Ω ‚Äî —É—Ç–æ—á–Ω—è–π –¥–µ—Ç–∞–ª–∏ (–º–µ—Å—Ç–æ, –≤—Ä–µ–º—è, –±—é–¥–∂–µ—Ç). 
–ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤—ã–¥—É–º—ã–≤–∞–π –Ω–µ—Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –∑–∞–≤–µ–¥–µ–Ω–∏–π. 
–ò—Å–ø–æ–ª—å–∑—É–π –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –æ –ª–æ–∫–∞—Ü–∏—è—Ö, –∫–∞—Ç–µ–≥–æ—Ä–∏—è—Ö –∏ —Ü–µ–Ω–∞—Ö.
```

### –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –º–∞—Ä—à—Ä—É—Ç–æ–≤
```
–¢—ã ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –≥–∏–¥ –ø–æ –≥–æ—Ä–æ–¥—É. 
–ù–∞ –æ—Å–Ω–æ–≤–µ 10 –æ—Ç–≤–µ—Ç–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –µ–≥–æ –∏—Å—Ç–æ—Ä–∏–∏ –º–∞—Ä—à—Ä—É—Ç–æ–≤ 
–≤–µ—Ä–Ω–∏ —á—ë—Ç–∫–∏–π –ø–æ—à–∞–≥–æ–≤—ã–π –ø–ª–∞–Ω: 5‚Äì9 –æ—Å—Ç–∞–Ω–æ–≤–æ–∫, –¥–ª—è –∫–∞–∂–¥–æ–π ‚Äî 
–∫—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ, –ø—Ä–∏–º–µ—Ä–Ω–∞—è –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –∞–¥—Ä–µ—Å/—Å—Å—ã–ª–∫–∞ (–µ—Å–ª–∏ –µ—Å—Ç—å), 
–∫–∞—Ç–µ–≥–æ—Ä–∏—è, –æ—Ä–∏–µ–Ω—Ç–∏—Ä–æ–≤–æ—á–Ω–æ–µ –≤—Ä–µ–º—è (—É—á–∏—Ç—ã–≤–∞–π –ø–æ–≥–æ–¥—É/–±—é–¥–∂–µ—Ç/—Ç–µ–º–ø). 

–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –º–∞–ª–æ ‚Äî –∑–∞–¥–∞–π 1‚Äì3 —É—Ç–æ—á–Ω–µ–Ω–∏—è. 
–ù–µ –≤—ã–¥—É–º—ã–≤–∞–π –∑–∞–∫—Ä—ã—Ç—ã–µ –º–µ—Å—Ç–∞; –æ—Ç–º–µ—á–∞–π —á–∞—Å—ã —Ä–∞–±–æ—Ç—ã. 

–ò—Ç–æ–≥: JSON {title, tags[], steps[], tips[], totalDuration} + 
–∫—Ä–∞—Ç–∫–∏–π summary (3‚Äì5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π).
```

## –ü—Ä–∏–º–µ—Ä –º–∞—Ä—à—Ä—É—Ç–∞ (JSON)

```json
{
  "id": "route-123",
  "title": "–ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∞—è –ú–æ—Å–∫–≤–∞ –∑–∞ –¥–µ–Ω—å",
  "summary": "–ò—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–π —Ü–µ–Ω—Ç—Ä: –ö—Ä–µ–º–ª—å, –ì–£–ú, –¢—Ä–µ—Ç—å—è–∫–æ–≤–∫–∞...",
  "tags": ["–∏—Å—Ç–æ—Ä–∏—è", "–∫—É–ª—å—Ç—É—Ä–∞", "–ø–µ—à–∫–æ–º"],
  "totalDuration": 480,
  "city": "–ú–æ—Å–∫–≤–∞",
  "steps": [
    {
      "id": "step-1",
      "title": "–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å",
      "description": "–ù–∞—á–Ω–∏—Ç–µ —Å –≥–ª–∞–≤–Ω–æ–π –ø–ª–æ—â–∞–¥–∏ —Å—Ç—Ä–∞–Ω—ã",
      "address": "–ö—Ä–∞—Å–Ω–∞—è –ø–ª–æ—â–∞–¥—å",
      "category": "museum",
      "duration": 60,
      "order": 1,
      "coordinates": { "lat": 55.753544, "lon": 37.621202 },
      "openHours": "09:00-18:00",
      "tips": ["–õ—É—á—à–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç—å —Å —É—Ç—Ä–∞", "–í–æ–∑—å–º–∏—Ç–µ –∞—É–¥–∏–æ–≥–∏–¥"]
    }
  ],
  "tips": ["–ù–∞–¥–µ–Ω—å—Ç–µ —É–¥–æ–±–Ω—É—é –æ–±—É–≤—å", "–í–æ–∑—å–º–∏—Ç–µ –≤–æ–¥—É"],
  "createdAt": "2025-10-15T10:00:00Z",
  "userId": "user-456",
  "isPublic": true,
  "likes": 142,
  "views": 1520
}
```

## –¢–µ—Ö–Ω–æ–ª–æ–≥–∏–∏

- **FastAPI** ‚Äì –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫
- **SQLAlchemy** ‚Äì ORM (PostgreSQL)
- **Redis** ‚Äì –∫—ç—à, –æ—á–µ—Ä–µ–¥–∏
- **Celery** ‚Äì —Ñ–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏ (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤)
- **OpenAI API** ‚Äì LLM –¥–ª—è —á–∞—Ç–∞ –∏ –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏
- **Pydantic** ‚Äì –≤–∞–ª–∏–¥–∞—Ü–∏—è
- **JWT** ‚Äì –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è

## –ó–∞–ø—É—Å–∫

```bash
cd backend
pip install -r requirements.txt
uvicorn app.main:app --reload
```

## Docker

```bash
docker-compose up
```

---

**–í—Å—ë –≥–æ—Ç–æ–≤–æ –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —Å —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–æ–º!** üöÄ
